{%- if section.settings.show_popup -%}
  {%- unless section.settings.show_only_on_index and template != 'index' -%}
    {%- unless section.settings.show_only_for_visitors and customer -%}
      {% capture section_settings %}
        {
          "apparitionDelay": {{ section.settings.apparition_delay | json }},
          "showOnlyOnce": {{ section.settings.show_only_once | json }}
        }
      {% endcapture %}

      <div
        class="NewsletterPopup"
        data-section-id="{{ section.id }}"
        data-section-type="newsletter-popup"
        data-section-settings='{{ section_settings }}'
        aria-hidden="true">
        <div>
          <div class="section-{{ section.id }}-padding gradient color-{{ section.settings.section_color_scheme }}">
  <div class="page-width">
    <div class="image-with-text image-with-text--{{ section.settings.content_layout }} isolate{% if settings.text_boxes_border_thickness > 0 and settings.text_boxes_border_opacity > 0 and settings.media_border_thickness > 0 and settings.media_border_opacity > 0 %} collapse-borders{% endif %}{% unless section.settings.color_scheme == section.settings.section_color_scheme and settings.media_border_thickness > 0 and settings.text_boxes_shadow_opacity == 0 and settings.text_boxes_border_thickness == 0 or settings.text_boxes_border_opacity == 0 %} collapse-corners{% endunless %}{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}">
      <div class="image-with-text__grid grid grid--gapless grid--1-col grid--{% if section.settings.desktop_image_width == 'medium' %}2-col-tablet{% else %}3-col-tablet{% endif %}{% if section.settings.layout == 'text_first' %} image-with-text__grid--reverse{% endif %}">
        <div class="image-with-text__media-item image-with-text__media-item--{{ section.settings.desktop_image_width }} image-with-text__media-item--{{ section.settings.desktop_content_position }} grid__item">
          <div
            class="image-with-text__media image-with-text__media--{{ section.settings.height }} global-media-settings{% unless remove_color_classes %} gradient color-{{ section.settings.color_scheme }}{% else %} background-transparent{% endunless %}{% if section.settings.image != blank %} media{% else %} image-with-text__media--placeholder placeholder{% endif %}{% if section.settings.image_behavior != 'none' %} animate--{{ section.settings.image_behavior }}{% endif %}"
            {% if section.settings.height == 'adapt' and section.settings.image != blank %}
              style="padding-bottom: {{ 1 | divided_by: section.settings.image.aspect_ratio | times: 100 }}%;"
            {% endif %}
          >
            {%- if section.settings.image != blank -%}
              {%- if section.settings.image_behavior == 'ambient' or section.settings.image_behavior == 'zoom-in' -%}
                {%- assign widths = '198, 432, 642, 900, 1284, 1800' -%}
                {%- capture sizes -%}
              (min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 100 | divided_by: 1.6667 }}px,
              (min-width: 750px) calc((100vw - 130px) / 1.667), calc((100vw - 50px) / 1.667)
            {%- endcapture -%}
              {%- else -%}
                {%- assign widths = '165, 360, 535, 750, 1070, 1500' -%}
                {%- capture sizes -%}
              (min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 100 | divided_by: 2 }}px,
              (min-width: 750px) calc((100vw - 130px) / 2), calc((100vw - 50px) / 2)
            {%- endcapture -%}
              {%- endif -%}
              {{
                section.settings.image
                | image_url: width: 1500
                | image_tag: sizes: sizes, widths: widths, fetchpriority: fetch_priority
              }}
            {%- else -%}
              {{ 'detailed-apparel-1' | placeholder_svg_tag: 'placeholder-svg' }}
            {%- endif -%}
          </div>
        </div>
        <div class="image-with-text__text-item grid__item">
          <div
            id="ImageWithText--{{ section.id }}"
            class="image-with-text__content image-with-text__content--{{ section.settings.desktop_content_position }} image-with-text__content--desktop-{{ section.settings.desktop_content_alignment }} image-with-text__content--mobile-{{ section.settings.mobile_content_alignment }} image-with-text__content--{{ section.settings.height }} content-container{% unless remove_color_classes %} gradient color-{{ section.settings.color_scheme }}{% else %} background-transparent{% endunless %}"
          >
            {%- for block in section.blocks -%}
              {% case block.type %}
                {%- when 'heading' -%}
                  <h2
                    class="image-with-text__heading inline-richtext {{ block.settings.heading_size }}"
                    {{ block.shopify_attributes }}
                  >
                    {{ block.settings.heading }}
                  </h2>
                {%- when 'caption' -%}
                  <p
                    class="image-with-text__text image-with-text__text--caption {{ block.settings.text_style }} {{ block.settings.text_style }}--{{ block.settings.text_size }} {{ block.settings.text_style }}"
                    {{ block.shopify_attributes }}
                  >
                    {{ block.settings.caption | escape }}
                  </p>
                {%- when 'text' -%}
                  <div class="image-with-text__text rte {{ block.settings.text_style }}" {{ block.shopify_attributes }}>
                    {{ block.settings.text }}
                  </div>
                {%- when 'button' -%}
                  {%- if block.settings.button_label != blank -%}
                    <a
                      {% if block.settings.button_link == blank %}
                        role="link" aria-disabled="true"
                      {% else %}
                        href="{{ block.settings.button_link }}"
                      {% endif %}
                      class="button{% if block.settings.button_style_secondary %} button--secondary{% else %} button--primary{% endif %}"
                      {{ block.shopify_attributes }}
                    >
                      {{ block.settings.button_label | escape }}
                    </a>
                  {%- endif -%}
              {%- endcase -%}
            {%- endfor -%}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
        </div>
        <button class="NewsletterPopup__Close" data-action="close-popup">{% render 'icon' with 'close' %}</button>

        {%- if section.settings.title != blank -%}
          <h2 class="NewsletterPopup__Heading Heading u-h2">{{ section.settings.title | escape }}</h2>
        {%- endif -%}

        {%- if section.settings.content != blank -%}
          <div class="NewsletterPopup__Content">
            {{ section.settings.content }}
          </div>
        {%- endif -%}

        {%- if section.settings.show_newsletter -%}
          {%- form 'customer'
            , id: 'newsletter-popup'
            , action: '/contact#newsletter-popup'
            , class: 'NewsletterPopup__Form' -%}
            {%- if form.posted_successfully? -%}
              <p class="Form__Alert Alert Alert--success">{{ 'general.popup.success' | t }}</p>
            {%- else -%}
              <input
                type="hidden"
                name="contact[tags]"
                value="newsletter">

              <input
                type="email"
                name="contact[email]"
                class="Form__Input"
                required="required"
                aria-label="{{ 'general.popup.email_placeholder' | t }}"
                placeholder="{{ 'general.popup.email_placeholder' | t }}">
              <button class="Form__Submit Button Button--primary Button--full" type="submit">{{ 'general.popup.submit' | t }}</button>
            {%- endif -%}
          {%- endform -%}
        {%- endif -%}
      </div>
    {%- endunless -%}
  {%- endunless -%}
{%- endif -%}
<style>
  .NewsletterPopup {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 300px;
    background-color: white;
    border: 1px solid #ddd;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    padding: 20px;
    z-index: 1000;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.3s ease
    , transform 0.3s ease;
  }

  .NewsletterPopup[aria-hidden="false"] {
    opacity: 1;
    transform: translateY(0);
  }

  .NewsletterPopup__Close {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    font-size: 20px;
    cursor: pointer;
  }

  .NewsletterPopup__Heading {
    margin-bottom: 10px;
    font-size: 18px;
    font-weight: bold;
  }

  .NewsletterPopup__Content {
    margin-bottom: 20px;
  }

  .NewsletterPopup__Form {
    display: flex;
    flex-direction: column;
  }

  .Form__Input {
    margin-bottom: 10px;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
  }

  .Form__Submit {
    padding: 10px;
    background-color: #333;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 4px;
    text-transform: uppercase;
  }

  .Form__Submit:hover {
    background-color: #555;
  }

  @media (max-width: 600px) {
    .NewsletterPopup {
      width: 90%;
      right: 5%;
      bottom: 10px;
    }
  }

</style>
<script>
  document.addEventListener("DOMContentLoaded", function() {
  var popup = document.querySelector('.NewsletterPopup');
  if (!popup) return;
  
  var settings = JSON.parse(popup.getAttribute('data-section-settings'));
  var closeButton = popup.querySelector('[data-action="close-popup"]');
  
  // Function to show the popup
  function showPopup() {
    if (!settings.showOnlyOnce || !localStorage.getItem('popupShown')) {
      popup.setAttribute('aria-hidden', 'false');
      localStorage.setItem('popupShown', 'true');
    }
  }
  
  // Function to close the popup
  function closePopup() {
    popup.setAttribute('aria-hidden', 'true');
  }
  
  // Close the popup when the close button is clicked
  closeButton.addEventListener('click', closePopup);
  
  // Show the popup after the defined delay
  setTimeout(showPopup, settings.apparitionDelay * 1000);
  });
</script>
{% schema %}
  {
    "name": "Popup",
    "settings": [
      {
        "type": "checkbox",
        "id": "show_popup",
        "label": "Enable",
        "default": false
      },
      {
        "type": "checkbox",
        "id": "show_only_on_index",
        "label": "Show only on home page",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "show_only_for_visitors",
        "label": "Show only for visitors",
        "info": "Customers who have created an account on your shop won't see it.",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "show_only_once",
        "label": "Show only once per customer",
        "default": true
      }, {
        "type": "text",
        "id": "title",
        "label": "Heading",
        "default": "Popup"
      }, {
        "type": "richtext",
        "id": "content",
        "label": "Text",
        "default": "<p>You can use this popup to display some useful information to your customers.</p>"
      }, {
        "type": "checkbox",
        "id": "show_newsletter",
        "label": "Show newsletter form",
        "default": true
      }, {
        "type": "range",
        "id": "apparition_delay",
        "min": 0,
        "max": 15,
        "step": 1,
        "unit": "sec",
        "label": "Delay until the popup appears",
        "default": 5
      }
    ],
    "presets": [
      {
        "name": "popup"
      }
    ]
  }
{% endschema %}